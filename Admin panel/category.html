<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Category Page</title>
    <link rel="stylesheet" href="./styledb.css" />
    <link rel="stylesheet" href="./stylecategory.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <div class="home">
          <i class="fa-solid fa-bars" id="menu"></i>
          <a href="./dashboard.html">Home</a>
        </div>
        <div class="timer">
          <span id="hour">00</span> : <span id="min">00</span> :
          <span id="sec">00</span> : <span id="time">AM</span>
        </div>
      </header>

      <aside>
        <div class="profile">
          <img src="./img/profile.jpg" alt="" />
        </div>
        <h3>Admin</h3>
        <ul>
          <li>
            <a href="./dashboard.html">
              <i class="fa-solid fa-house" style="color: white"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
             <a href="./category.html">
               <i class="fa-solid fa-list" style="color: white"></i>
              <span>Category</span>
            </a>
          </li>
          <li>
             <a href="./products.html">
               <i class="fa-solid fa-bag-shopping" style="color: white"></i>
              <span>Products</span>
            </a>
          </li>
          <li>
             <a href="./customer.html">
              <i class="fa-solid fa-users" style="color: white"></i>
              <span>Customer</span>
            </a>
          </li>
          <li>
             <a href="javascript:void(0)" onclick="logout()">
              <i class="fa-solid fa-arrow-right-from-bracket"style="color: white"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>

        <div class="icons">
          <a href="https://www.instagram.com/"
            ><i class="fa-brands fa-instagram"></i
          ></a>
          <a href="https://x.com/"><i class="fa-brands fa-twitter"></i></a>
          <a href="https://www.facebook.com/"
            ><i class="fa-brands fa-facebook-f"></i
          ></a>
          <a href="https://in.linkedin.com/"
            ><i class="fa-brands fa-square-linkedin"></i
          ></a>
        </div>
      </aside>

      <main>
        <form id="categoryForm">
          <h3>Category</h3>
          <input type="hidden" id="categoryid" />
          <label for="url" class="name">Image URL</label>
          <input type="text" placeholder="Enter image url" id="img" />
          <span id="imgerr" class="err"></span> <br />

          <input type="text" placeholder="Product category" id="catgry" />
          <span id="catgryerr" class="err"></span>

          <button type="submit" id="submitbtn">Submit</button>
          <button type="submit" id="updatebtn" style="display: none">
            Update
          </button>
        </form>

        <table>
          <thead>
            <tr>
              <th>S.no</th>
              <th>ProductId</th>
              <th>Product img</th>
              <th>Product Name</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="data"></tbody>
        </table>
      </main>

      <footer>
        <p>Â© 2026 Kamali Muruganantham. All rights reserved.</p>
      </footer>
    </div>

    <script>
      function logout() {
        Swal.fire({
          title: "Are you sure?",
          text: "Do you really want to logout?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes, Logout",
          cancelButtonText: "Cancel",
        }).then((result) => {
          if (result.isConfirmed) {
            localStorage.removeItem("isLogin");
            localStorage.removeItem("activeUser");

            Swal.fire({
              title: "Logged Out!",
              text: "Logout Successfully",
              icon: "success",
              timer: 1500,
              showConfirmButton: false,
            });

            setTimeout(() => {
              window.location.href = "index.html";
            }, 2000);
          }
        });
      }
      //Menu
      let menu = document.querySelector("#menu");
      let aside = document.querySelector("aside");
      let wrapper = document.querySelector(".wrapper");

      menu.addEventListener("click", () => {
        aside.classList.toggle("hide");
        wrapper.classList.toggle("hide-sidebar");
      });

      //submit refresh prevent
      let catgy_btn = document.getElementById("categoryForm");
      catgy_btn.addEventListener("submit", (e) => {
        e.preventDefault();

        let cid = document.getElementById("categoryid").value;

        if (cid) {
          updateData();
        } else {
          categorycreate();
        }
      });
      //set Interval
      let hour = document.querySelector("#hour");
      let min = document.querySelector("#min");
      let sec = document.querySelector("#sec");
      let Time = document.querySelector("#time");

      setInterval(() => {
        let d = new Date();

        let h = d.getHours();
        let m = d.getMinutes();
        let s = d.getSeconds();

        let period = h >= 12 ? "PM" : "AM";

        hour.innerHTML = String(h).padStart(2, "0");
        sec.innerHTML = String(s).padStart(2, "0");
        Time.innerHTML = period;
      }, 1000);

      //localstorage

      let categorycreate = () => {
        let image = document.getElementById("img").value;
        let category = document.getElementById("catgry").value;

        let catgryerr = document.getElementById("catgryerr");
        let imageerr = document.getElementById("imgerr");

        // let imgPattern = /^(https?:\/\/.*\.(png|jpg|jpeg|gif|webp))$/i;
        let catPattern = /^[a-zA-Z0-9 &.,-]{3,30}$/;
        let ischecked = true;

        if (image == "") {
          imageerr.innerText = "Enter valid image URL";
          document.getElementById("img").style.border = "1px solid red";
          ischecked = false;
        } 
        // else if (!imgPattern.test(image)) {
        //   imageerr.innerText = "Invalid URL";
        //   img.style.border = "1px solid red";
        //   ischecked = false;
        // } 
        else {
          imageerr.innerText = "";
          document.getElementById("img").style.border = "";
        }

        if (category == "") {
          catgryerr.innerText = "Enter your Category";
          document.getElementById("catgry").style.border = "1px solid red";
          ischecked = false;
        } else if (!catPattern.test(category)) {
          catgryerr.innerText = "Min 3 letters";
          catgry.style.border = "1px solid red";
          ischecked = false;
        } else {
          catgryerr.innerText = "";
          document.getElementById("catgry").style.border = "1px solid green";
        }
        if (!ischecked) return; //validation fail STOP update

        let categoryList =
          JSON.parse(localStorage.getItem("categoryList")) || []; // Data safety, no conflicts

        let match = categoryList.filter(
          //existing user duplicate check
          (ele) =>
            ele.category.toLowerCase() === category.toLowerCase() &&
            ele.image === image,
        );

        if (match.length > 0) {
          Swal.fire({
            icon: "warning",
            title: "Already Exists",
            text: "This category already exists!",
          });
          return;
        }

        if (ischecked) {
          let ctydata = {
            productid: Date.now(),
            image,
            category,
          };

          categoryList.push(ctydata);

          localStorage.setItem("categoryList", JSON.stringify(categoryList));
          Swal.fire({
            icon: "success",
            title: "Category Created!",
            timer: 1200,
            showConfirmButton: false,
          });

          categorytable();
          document.getElementById("catgry").value = "";
          document.getElementById("img").value = ""; //reset
        }
      };
      //table
      let categorytable = () => {
        let data1 = document.getElementById("data");
        let cty = JSON.parse(localStorage.getItem("categoryList")) || [];

        let tab = "";

        if (cty.length > 0) {
          cty.forEach((b, index) => {
            tab += `<tr>
                    <td>${index + 1}</td>
                    <td>${b.productid}</td>
                    <td><img src="${b.image}" alt="${b.category}"/></td>
                    <td>${b.category}</td>
                    <td>
                      <button type="button" onclick="catgyupdate(${b.productid})" id="updatebtn">
                        <i class="fa-solid fa-pen"></i>
                      </button>
                      <button type="button" onclick="catgydelete(${b.productid})" id="deletebtn">
                        <i class="fa-solid fa-trash"></i>
                      </button>
                    </td>
                  </tr>`;
          });
        } else {
          tab = `<tr><td colspan="4" align="center">No Records Found</td></tr>`;
        }

        data1.innerHTML = tab;
      };

      categorytable();

      //update category

      let catgyupdate = (productid) => {
        let categoryList =
          JSON.parse(localStorage.getItem("categoryList")) || [];

        let fpl = categoryList.filter((ele) => ele.productid == productid);
        let [product] = fpl;

        document.getElementById("categoryid").value = product.productid;
        document.getElementById("img").value = product.image;
        document.getElementById("catgry").value = product.category;

        document.getElementById("submitbtn").style.display = "none";
        document.getElementById("updatebtn").style.display = "inline-block";
      };

      // update save
      let updateData = () => {
        let cid = document.getElementById("categoryid").value;
        let image = document.getElementById("img").value;
        let category = document.getElementById("catgry").value;

        if (image == "" || category == "") {
          Swal.fire("Error", "Fill all fields before updating", "error");
          return; //Check empty fields stop submit & update
        }
        let categoryList =
          JSON.parse(localStorage.getItem("categoryList")) || [];

        let catgyData = {
          productid: Number(cid),
          category: category,
          image: image,
        };

        let updatedList = categoryList.map((ele) => {
          if (ele.productid == cid) {
            return catgyData;
          } else {
            return ele;
          }
        });

        localStorage.setItem("categoryList", JSON.stringify(updatedList));

        Swal.fire({
          icon: "success",
          title: "Updated!",
          timer: 1200,
          showConfirmButton: false,
        });

        categorytable();

        document.getElementById("categoryid").value = "";
        document.getElementById("img").value = "";
        document.getElementById("catgry").value = "";

        document.getElementById("submitbtn").style.display = "inline-block";
        document.getElementById("updatebtn").style.display = "none";
      };

      // delete category
      let catgydelete = (productid) => {
        Swal.fire({
          title: "Are you sure?",
          text: "Do you want to delete this product?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes,delete it!",
          cancelButtonText: "Cancel",
        }).then((result) => {
          if (result.isConfirmed) {
            let categoryList =
              JSON.parse(localStorage.getItem("categoryList")) || [];

            let updatedList = categoryList.filter(
              (ele) => ele.productid !== productid,
            );

            localStorage.setItem("categoryList", JSON.stringify(updatedList));

            Swal.fire({
              title: "Deleted!",
              text: "Your file has been deleted.",
              icon: "success",
            });

            categorytable();
          }
        });
      };
    </script>
  </body>
</html>
